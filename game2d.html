<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Game 2D test</title>
        <link rel="stylesheet" href="css/styleJeu2D.css">
    </head>
    <body>
        <script>
            /*
                Variables Globales
            */
            const sizeTableGame = {
                sizeX: 7,
                sizeY: 7,
            }

            const player = {
                DOMElement: null,
                posX: 0,
                posY: 0,
            }

            const objets = {
                cle: {
                    DOMElement: null,
                    found: false,
                    posX: 3,
                    posY: 4,
                },
                porte: {
                    DOMElement: null,
                    open: false,
                },
            }


            /*
                Code Principal
            */
            const tableauGLO = createTable(sizeTableGame.sizeX, sizeTableGame.sizeY);
            setEventListeners(tableauGLO)


            /*
                Fonctions
            */
            function createTable(sizeX, sizeY){
                let tableDOM = document.createElement("table");
                let tableau = [];

                for(var i = 0; i < sizeX; i++){
                    let row = document.createElement("tr");
                    let ligne = [];

                    for(var j = 0; j < sizeY; j++){
                        let column = document.createElement("td");
                        
                        if (player.posX == i && player.posY == j){
                            column.id = "player";
                            player.DOMElement = column;

                        } else if (i == sizeX-1 && j == sizeY-1){
                            objets.porte.DOMElement = column;
                            objets.porte.DOMElement.classList= "porte"

                        } else if (i == objets.cle.posX && j == objets.cle.posY){
                            objets.cle.DOMElement = column;
                            objets.cle.DOMElement.classList = "cle"
                        }

                        row.appendChild(column);
                        ligne.push(column);
                    }
                    tableDOM.appendChild(row);
                    tableau.push(ligne);
                }
                tableDOM.id = "tableDeJeu";

                document.body.appendChild(tableDOM);
                return tableau;
            }
        
            function setEventListeners(tableau){
                tableau.forEach((line) => {
                    line.forEach((element) => {
                        element.addEventListener("click", () => { changePlayerPosition(element) })
                    })
                })
            }

            function changePlayerPosition(newPosition){
                var coordonnes = getCoordinates(newPosition);
                if (newPosition == objets.cle.DOMElement){
                    player.DOMElement.id = "";
                    newPosition.id = "player";

                    objets.porte.open = true;
                    objets.porte.DOMElement.classList += " open";
                    
                    objets.cle.found = true;
                    objets.cle.DOMElement.classList = "";

                } else if (newPosition == objets.porte.DOMElement){
                    if (objets.porte.open){
                        player.DOMElement.id = "";
                        newPosition.id = "player";
                        alert("Gagné !");

                    } else {
                        alert("Vous ne pouvez pas y renter ! Il vous faut une clé !")
                        return
                    }
                } else {
                    player.DOMElement.id = "";
                    newPosition.id = "player";

                }
                player.DOMElement = newPosition;
            }

            function getCoordinates(domContent){
                for(var y = 0; y < tableauGLO.length; y++){
                    for(var x = 0; x < tableauGLO[y].length; x++){
                        if (tableauGLO[y][x] == domContent){
                            return {x, y}
                        }
                    }
                }
            }
        </script>
    </body>
</html>